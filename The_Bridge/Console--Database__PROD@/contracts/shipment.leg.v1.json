{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Shipment Leg Event",
  "description": "Event for tracking individual transport legs in supply chain",
  "type": "object",
  "required": ["headers", "payload"],
  "properties": {
    "headers": {
      "type": "object",
      "required": [
        "world",
        "division",
        "capability",
        "version",
        "tenant_id",
        "occurred_at",
        "payload_schema"
      ],
      "properties": {
        "world": {
          "type": "string",
          "const": "Continuum_Overworld"
        },
        "division": {
          "type": "string",
          "enum": ["Atlas", "Oracle", "Forge"]
        },
        "capability": {
          "type": "string",
          "enum": ["Planner", "Calculator", "Tracker"]
        },
        "role": {
          "type": "string"
        },
        "qualifier": {
          "type": "string"
        },
        "version": {
          "type": "string",
          "pattern": "^v\\d+\\.\\d+\\.\\d+$"
        },
        "tenant_id": {
          "type": "string",
          "minLength": 1
        },
        "project_tag": {
          "type": "string"
        },
        "agent_run_id": {
          "type": "string"
        },
        "occurred_at": {
          "type": "string",
          "format": "date-time"
        },
        "payload_schema": {
          "type": "string",
          "const": "shipment.leg.v1"
        },
        "correlation_id": {
          "type": "string"
        },
        "causation_id": {
          "type": "string"
        }
      }
    },
    "payload": {
      "type": "object",
      "required": ["shipment_code", "leg_number", "mode", "from_location", "to_location"],
      "properties": {
        "shipment_code": {
          "type": "string",
          "description": "Unique shipment identifier"
        },
        "batch_code": {
          "type": "string",
          "description": "Associated batch code"
        },
        "leg_number": {
          "type": "integer",
          "minimum": 1,
          "description": "Sequential leg number in journey"
        },
        "mode": {
          "type": "string",
          "enum": ["truck", "rail", "air", "sea", "barge", "multimodal"]
        },
        "from_location": {
          "type": "object",
          "required": ["name"],
          "properties": {
            "name": {
              "type": "string"
            },
            "code": {
              "type": "string",
              "description": "IATA/ICAO/UN/LOCODE"
            },
            "coordinates": {
              "type": "object",
              "properties": {
                "latitude": {
                  "type": "number"
                },
                "longitude": {
                  "type": "number"
                }
              }
            }
          }
        },
        "to_location": {
          "type": "object",
          "required": ["name"],
          "properties": {
            "name": {
              "type": "string"
            },
            "code": {
              "type": "string",
              "description": "IATA/ICAO/UN/LOCODE"
            },
            "coordinates": {
              "type": "object",
              "properties": {
                "latitude": {
                  "type": "number"
                },
                "longitude": {
                  "type": "number"
                }
              }
            }
          }
        },
        "distance_km": {
          "type": "number",
          "minimum": 0
        },
        "payload": {
          "type": "object",
          "properties": {
            "mass_kg": {
              "type": "number",
              "minimum": 0
            },
            "volume_m3": {
              "type": "number",
              "minimum": 0
            },
            "units": {
              "type": "integer",
              "minimum": 0
            },
            "commodity": {
              "type": "string"
            },
            "hs_code": {
              "type": "string"
            }
          }
        },
        "vehicle": {
          "type": "object",
          "properties": {
            "class": {
              "type": "string",
              "description": "Vehicle class per DEFRA/GLEC"
            },
            "fuel_type": {
              "type": "string",
              "enum": ["diesel", "petrol", "electric", "lng", "cng", "hydrogen", "biofuel", "jet_fuel"]
            },
            "euro_standard": {
              "type": "string",
              "enum": ["Euro_4", "Euro_5", "Euro_6", "Euro_6d"]
            },
            "load_factor_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "backhaul": {
              "type": "boolean"
            }
          }
        },
        "carrier": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "code": {
              "type": "string"
            },
            "vessel_name": {
              "type": "string",
              "description": "For sea freight"
            },
            "flight_number": {
              "type": "string",
              "description": "For air freight"
            }
          }
        },
        "timing": {
          "type": "object",
          "properties": {
            "scheduled_departure": {
              "type": "string",
              "format": "date-time"
            },
            "actual_departure": {
              "type": "string",
              "format": "date-time"
            },
            "scheduled_arrival": {
              "type": "string",
              "format": "date-time"
            },
            "actual_arrival": {
              "type": "string",
              "format": "date-time"
            },
            "duration_hours": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "emissions": {
          "type": "object",
          "description": "Calculated emissions for this leg",
          "properties": {
            "co2e_kg": {
              "type": "number",
              "minimum": 0
            },
            "ttw_kg": {
              "type": "number",
              "minimum": 0,
              "description": "Tank-to-Wheel emissions"
            },
            "wtt_kg": {
              "type": "number",
              "minimum": 0,
              "description": "Well-to-Tank emissions"
            },
            "calculation_method": {
              "type": "string",
              "enum": ["distance_based", "fuel_based", "spend_based"]
            },
            "factor_source": {
              "type": "string"
            },
            "rf_applied": {
              "type": "boolean",
              "description": "Radiative Forcing applied (air freight)"
            }
          }
        },
        "temperature": {
          "type": "object",
          "description": "For cold chain",
          "properties": {
            "controlled": {
              "type": "boolean"
            },
            "range_celsius": {
              "type": "object",
              "properties": {
                "min": {
                  "type": "number"
                },
                "max": {
                  "type": "number"
                }
              }
            }
          }
        },
        "status": {
          "type": "string",
          "enum": ["planned", "in_transit", "completed", "delayed", "cancelled"]
        }
      }
    }
  }
}